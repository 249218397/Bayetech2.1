<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
	<meta charset="utf-8" />
    <link href="../../Content/CommonCss/global.css" rel="stylesheet" />
    <link href="../../Content/CommonCss/Public.css" rel="stylesheet" />
    <link href="../../Content/CommonCss/buy.css" rel="stylesheet" />
    <link href="../../Content/CommonCss/popLayer.css" rel="stylesheet" />
    <link href="../../Content/CommonCss/sell.css" rel="stylesheet" />

    <script src="../../Scripts/require.js"></script>
    <script src="../../Scripts/jsconfig.js"></script>
    <script src="../../Scripts/app/PlaceOrder/index.js"></script>
    <style type="text/css">
        .txcpdd ul li span {
            width: 90px;
        }

        #dxk {
            background: #fff;
            margin-left: 90px;
            border: none;
        }

        .cutpicli {
            overflow: hidden;
        }

        .cutpic {
            width: 558px;
            height: 188px;
            border: 1px solid #ccc;
            float: left;
            padding: 20px;
        }

            .cutpic p {
                background: #fffcf0;
                border: 1px solid #ffcc33;
                line-height: 20px;
                padding: 10px 15px;
            }

        .webuploader-container {
            position: relative;
        }

        .webuploader-element-invisible {
            position: absolute !important;
            clip: rect(1px 1px 1px 1px); /* IE6, IE7 */
            clip: rect(1px,1px,1px,1px);
        }

        .webuploader-pick {
            position: relative;
            display: inline-block;
            cursor: pointer;
            background: #00b7ee;
            padding: 10px 15px;
            color: #fff;
            text-align: center;
            border-radius: 3px;
            overflow: hidden;
        }

        .webuploader-pick-hover {
            background: #00a2d4;
        }

        .webuploader-pick-disable {
            opacity: 0.6;
            pointer-events: none;
        }

        .bl-uploader-box {
            padding-top: 20px;
            margin-left: 15px;
            width: 110px;
            height: 110px;
            overflow: hidden;
            float: left;
        }

            .bl-uploader-box .uploader-list .file-item {
                width: 110px;
                height: 110px;
                float: left;
                margin-right: 12px;
                margin-bottom: 12px;
                position: relative;
            }

                .bl-uploader-box .uploader-list .file-item img {
                    width: 110px;
                    height: 110px;
                }

                .bl-uploader-box .uploader-list .file-item .info {
                    position: absolute;
                    left: 0px;
                    bottom: 0px;
                    width: 110px;
                    text-align: center;
                    height: 26px;
                    line-height: 26px;
                    background: #000;
                    opacity: 0.8;
                    filter: alpha(opacity=80);
                    -moz-opacity: 0.8;
                    -khtml-opacity: 0.8;
                    color: #fff;
                }

                .bl-uploader-box .uploader-list .file-item .error {
                    position: absolute;
                    left: 0px;
                    top: 0px;
                    width: 110px;
                    text-align: center;
                    height: 26px;
                    line-height: 26px;
                    background: red;
                    opacity: 0.8;
                    filter: alpha(opacity=80);
                    -moz-opacity: 0.8;
                    -khtml-opacity: 0.8;
                    color: #fff;
                }

                .bl-uploader-box .uploader-list .file-item .del-img {
                    position: absolute;
                    z-index: 99;
                    cursor: pointer;
                    right: 0px;
                    top: -0;
                    text-align: center;
                    width: 20px;
                    height: 20px;
                    background: url(http://pic.7881.com/7881/market/images/sell/picclose-icon.png) top right no-repeat;
                    line-height: 26px;
                    color: #333;
                }

            .bl-uploader-box .btns {
                float: left;
                margin-bottom: 30px;
            }

                .bl-uploader-box .btns #picker {
                    width: 110px;
                    height: 110px;
                    text-align: center;
                }

                    .bl-uploader-box .btns #picker .webuploader-pick {
                        background: transparent;
                        color: #999;
                        width: 110px;
                        height: 110px;
                        overflow: hidden;
                        padding: 0;
                    }

        .cutsl {
            width: 110px;
            height: 110px;
            float: left;
            margin: 20px 0 0 20px;
            position: relative;
        }

            .cutsl img {
                width: 110px;
                height: 110px;
            }

            .cutsl p {
                position: absolute;
                width: 100%;
                text-align: center;
                bottom: 0;
                left: 0;
                height: 18px;
                line-height: 18px;
                font-size: 12px;
                color: #fff;
                background: #3399ff;
                padding: 0;
                border: 0;
            }
    </style>
    <script type="text/javascript" src="/market/js/kefu.js"></script>
    <script type="text/javascript" src="http://www.7881.com/market/transaction/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/common/js/restrict_input.js"></script>
    <script type="text/javascript" src="http://www.7881.com/market/transaction/webuploader.min.js"></script>
    <script type="text/javascript" src="http://pic.7881.com/7881/market/js/lightbox-plus-jquery.min.js"></script>
    <script type="text/javascript">

        function roleSelected(prid) {
            $('#dxk div').hide();
            $('#div_' + prid).show();

            if(prid == "-1" || prid == "0"){
                var gameId='G10';
                var gtid='100001';
                if(gameId=='G10' && (gtid=='100001'||gtid=='100002' || gtid=='100111')){
                    if(gtid=='100001'){
                        $("#fuzhi_0").show();
                        $("#fuzhi_-1").show();
                    }
                    if(gtid=='100111'||gtid=='100002')
                        $("#fuzhi_0").show();
                        $("#fuzhi_-1").show();
                }else{
                    $('#div_' + prid+'  #fuzhi_'+prid).show();
                }
            }else{
            	$('#div_' + prid+'  #fuzhi_'+prid).hide();
            }
        }

        function checkPurchase() {
        	if('G10' == 'G479' && '100001' == '100074'){
        		// 取得买家收货属性
                var info = [];
        		var rolename = $('#pt_rolename').val();
        		if(typeof(rolename) == "undefined"){
        			rolename = "null";
        		}
        		var rolegrade = $('#pt_rolegrade').val();
        		if(typeof(rolegrade) == "undefined"){
        			rolegrade = "null";
        		}
        		info.push({
                    'rolename': rolename,
                    'rolelevel': rolegrade,
                    'stock': eval($('#pernum').val() + '*' + $('#stock').val())
                });
                goodinfo = BaseJs.Json.encode(info);
                $('#goodsinfo').val(goodinfo);
        	}else if('100001' == '100149'){
        		// 取得买家收货属性
                var info = [];
        		info.push({
                    'rolename': "null",
                    'rolelevel': "null",
                    'stock': eval($('#pernum').val() + '*' + $('#stock').val())
                });
                goodinfo = BaseJs.Json.encode(info);
                $('#goodsinfo').val(goodinfo);
        	}else if('100001' == '100150'){
                // 取得买家收货属性
                var info = [];
                info.push({
                    'rolename': "null",
                    'rolelevel': "null",
                    'stock': eval($('#pernum').val() + '*' + $('#stock').val())
                });
                goodinfo = BaseJs.Json.encode(info);
                $('#goodsinfo').val(goodinfo);
        	}else{
                if('G10' == 'G10' && ('100001' == '100148' || '100001' == '100151')){
//                	$('#buyerRolename').val($('#dxk div:visible textarea:eq(0)').val());
//                    $('#buyerRolename').val($('#txtRole').val());
                    $('#prid').val(0);
                }else{
                    $('#prid').val($('#dxk div:visible').attr('id').split('_')[1]);
                    $('#buyerRolename').val($('#dxk div:visible dl input:text:eq(0)').val());
                    $('#grade').val($('#dxk div:visible dl input:text:eq(2)').val());
                }

                // 问道，QQ仙灵游戏需要填写数字ID
                if ('G10' == 'G39' || 'G10' == 'G670' || 'G10' == 'G986' || '100001' == '100045') {
                    $('#numberid').val($('#dxk div:visible dl input:text:eq(3)').val());
                }

                // 取得买家收货属性
                var info = [];
                var roleLevel = !$('#txtRoleLevel').val() ? 0 : $('#txtRoleLevel').val();

                var rolelevel2 = $('#grade').val()=="" ? "0":$('#grade').val();
                if('G10' == 'G10' && '100001' == '100001' && 'js' == 'js'){
                    rolelevel2 = "";
                }

                info.push({
                    'rolename': $('#buyerRolename').val(),
                    'rolelevel': rolelevel2,
                    'stock': eval($('#pernum').val() + '*' + $('#stock').val())
                });
                goodinfo = BaseJs.Json.encode(info);
                $('#goodsinfo').val(goodinfo);
        	}


            var uploadAuctionImg = "";
            var uploadSuccess = true;
            $.each($('#thelist').children(), function(i, item){
                if(typeof($(item).attr("url")) == "undefined" || $(item).attr("url") == "" || $(item).children(".progress").length > 0 ){
                    uploadSuccess = false;
                    return false;
                }
                if (i != 0) {
                    uploadAuctionImg += ',';
                }
                uploadAuctionImg += $(item).attr("url");
            });
            if(uploadSuccess == false){
                uploadAuctionImg = '';
                alert('图片上传还未完成，请稍后');
                return;
            }
            if(uploadAuctionImg != ""){
                $("#uploadAuctionImg").val(uploadAuctionImg);
            }


            var goodsprice = eval($('#price').val() + '*' + $('#stock').val()).toFixed(3);
            goodsprice=goodsprice+'';
            if(goodsprice.indexOf(".")!=-1){
                goodsprice=goodsprice.substring(0, goodsprice.indexOf(".")+3);
            }
            if(parseFloat(goodsprice)<0.01){
                goodsprice=0.01;
            }
            $('#goodsprice').val(goodsprice);
            $('#text_goodsprice').val(goodsprice);

            $.ajax({
                type: 'post',
                data: {goodsid: '201612376080214'},
                url: '/procurement/queryGoodsStock.action',
                dataType: 'text',
                success: function (data) {
                    if (data < 1) {
                        alert('很抱歉，该商品已售完，请选择其他同类商品');
                        window.location.href = '/buy-G10-100001-G10P008-G10P008006-0-0-0-0-0-0.html';
                    } else {
                        $('#hlkOK').attr('disabled', true);
                        $('#goodsForm').submit();
                    }
                }
            });
            return false;
        }

        function checkNum(count) {

            $('#checkNum').html(count);

        }
        function changedelivertype(id){
        var str="";
           if(id=="post"){
              str="邮寄后<label style='color:red'>30分钟</label>才可收到邮件";
           }else{
              str="为加快交易速度，订单支付成功后，请您在扬州交易区<信使>处等待交易员与您交易，交易员不会以任何理由索要回交易出去的商品";
           }
           $("#dxk_aq").html(str);
        }
        function getByteLen(val) {
            var len = 0;
            for (var i = 0; i < val.length; i++) {
                var length = val.charCodeAt(i);
                if(length>=0&&length<=128)
                {
                    len += 1;
                }
                else
                {
                    len += 2;
                }
            }
            return len;
        }
    </script>
</head>
<body>
    <!--头部开始-->
    <!--  -->
    <!--头部开始-->
    <div class="top">
        <div class="width980_top">
            <div class="welcome">欢迎来到7881&nbsp;&nbsp;<span id="span_user"><a href="/7881_touristlogin.jsp" class="dlzc" rel="nofollow">请登录</a> - <a href="/reg.jsp" class="dlzc" rel="nofollow">免费注册</a></span></div>

            <!--		<div class="right obtainTop myweixin" id="div_weixin">
                            <div class="my_rice nav_text_5">官方微信</div>
                            <ul class="mine_cont_4">
                                <li><img src="http://pic.7881.com/7881/market/images/7881_weixin.jpg" align="absmiddle" /></li>
                            </ul>
            </div>
            <span class="right_top3">|</span>-->
            <div class="right obtainTop top_index" id="div_blog">
                <div class="my_rice nav_text_3"><a href="http://e.weibo.com/u/3578882991/" target="_blank" rel="nofollow">官方微博</a></div>
                <ul class="mine_cont_2">
                    <li><a href="http://e.weibo.com/u/3578882991/" target="_blank" rel="nofollow"><img src="http://pic.7881.com/7881/market/images/sina_wb.png" align="absmiddle" /> 新浪微博</a></li>
                    <li><a href="http://t.qq.com/game7881/" target="_blank" rel="nofollow"><img src="http://pic.7881.com/7881/market/images/tencent_wb.png" align="absmiddle" /> 腾讯微博</a></li>
                </ul>
            </div>
            <span class="right_top3">|</span>
            <div class="right obtainTop myService" id="div_Service">
                <div class="my_rice nav_text_4">服务中心</div>
                <ul class="mine_cont_3">
                    <li>
                        <a href="/helpCenter.html" target="_blank" rel="nofollow">帮助中心</a>
                    </li>
                    <li>
                        <a href="/articlelist4-0-0.html" target="_blank" rel="nofollow">资讯中心</a>
                    </li>
                    <li>
                        <a href="/tradesafe.html" target="_blank" rel="nofollow">安全中心</a>
                    </li>
                    <li>
                        <a href="/sc/sc_index.html" target="_blank" rel="nofollow">客服中心</a>
                    </li>
                </ul>
            </div>
            <span class="right_top3">|</span>
            <div class="right obtainTop top_index" id="div_seller">
                <div class="my_rice nav_text_2"><a href="/personal.html" rel="nofollow">我是卖家</a></div>
                <ul class="mine_cont_1">
                    <li><a href="/sellertool/queryMySaleOrder.action" rel="nofollow">我的订单管理</a></li>
                    <li><a href="/procurement/showMyGoods.action" rel="nofollow">出售中的商品</a></li>
                    <li><a href="/sellertool/queryMyClosedGoods.action" rel="nofollow">仓库中的商品</a></li>
                    <li><a href="/release.html" rel="nofollow">我要卖</a></li>
                    <li><a href="/financecharge/toAddExtractcash.action" rel="nofollow">提现</a></li>
                </ul>
            </div>
            <span class="right_top3">|</span>
            <span class="right obtainTop myrice" id="div_buyer">
                <div class="my_rice nav_text"><a href="/personal.html" rel="nofollow">我是买家</a></div>
                <ul class="mine_cont">
                    <li><a href="/procurement/queryMyProcureOrder.action" rel="nofollow">我购买的订单</a></li>
                    <li><a href="/gamelistshow.html" rel="nofollow">我要买</a></li>
                    <li><a href="/financecharge/toAdd.action" rel="nofollow">充值</a></li>
                </ul>
            </span>
            <span class="right_top3">|</span>
            <span class="right_top2"><a href="/personal.html" rel="nofollow">个人中心</a></span>
            <span class="right_top3">|</span>
            <span class="right_top"><a href="/" target="_blank" rel="nofollow">首页</a></span>
        </div>
    </div>
    <script type="text/javascript">
	// 判断是否登录
	jQuery.ajax({
		type : 'get',
		url : '/loginCheckReturn.action?ip=' + Math.round(Math.random()*10000),
		success : function(resultData) {
			var result = resultData.split('#');
			if(result[0] == '500')
			{
				location.href="/7881_touristlogin.jsp";
			}
			else if (result[0] == '200' && result.length > 2) {
				 jQuery('#span_user').empty();
				 if(result[2]!='0'){
				 	htmlText = '<a class="dlzc" rel="nofollow" href="/personal.html">'+result[1]+'</a>&nbsp;&nbsp;<a class="dlzc" href="/msg/notReadMsg.action" rel="nofollow"><img align="absmiddle" src="http://pic.7881.com/7881/market/images/Personal/znx_wd.png"/>[' + result[2] + ']</a>&nbsp;&nbsp; <a href="/logout.action" rel="nofollow">退出</a>';
				 }else{
				 	htmlText = '<a class="dlzc" rel="nofollow" href="/personal.html">'+result[1]+'</a>&nbsp;&nbsp;<a class="dlzc" href="/msg/notReadMsg.action" rel="nofollow"><img align="absmiddle" src="http://pic.7881.com/7881/market/images/Personal/message.png"/>[' + result[2] + ']</a>&nbsp;&nbsp; <a href="/logout.action" rel="nofollow">退出</a>';
				 }
				 jQuery('#span_user').html(htmlText);
			}
		}
	});

	$('#div_seller,#div_buyer,#div_blog,#div_Service').hover(
		function(){
			$(this).addClass('hover');
		},
		function(){
			$(this).removeClass('hover');
		}
	);

	document.domain="7881.com";
    </script>
    <div id="div_popup_layer">
        <div class="box">
            <div id="div_light" class="pops" style="display: none;">
                <h2><span>友情提示</span><a href="/goods-201612376080214.html"></a></h2>
                <dl>
                    <dt>亲爱的用户，您未支付的订单太多了！</dt>
                    <dd>您需要先处理未支付订单后，方可继续购买</dd>
                    <dd>
                        <a href="/procurement/queryMyProcureOrder.action" class="s1">我购买的订单</a><a href="/goods-201612376080214.html" class="s2">返回商品详情</a>
                    </dd>
                </dl>
            </div>
        </div>
        <div id="div_fade" class="mask" style="display: none;"></div>
    </div>
    <!--  -->
    <script type="text/javascript" src="/market/transaction/jquery-1.11.1.min.js"></script>
    <!--<script type="text/javascript" src="/common/js/jquery1.5.js"></script>-->
    <script type="text/javascript" src="/market/7881_logo_modify.js"></script>
    <script type="text/javascript">
	var gametype="";
    </script>
    <div class="center logo">
        <div class="left">
            <a id="logoid"><img src="http://pic.ofcard.com/7881/market/images/7881_logo.jpg" title="7881-游戏交易站" /></a>
        </div>
        <div>
            <div class="gm_lc">
                <div id="div1" class="gm_lc_wz_1 gm_lc_1">
                    1.填写收货信息
                </div>
                <div id="div2" class="gm_lc_wz_2 gm_lc_2">
                    2.在线付款
                </div>
                <div id="div3" class="gm_lc_wz_3 gm_lc_2">
                    3.确认收货
                </div>
                <!--<div id="div4" class="gm_lc_wz_4 gm_lc_2">
                    4.完成
                </div>-->
            </div>
        </div>
    </div>
    <!--头部结束-->
    <div class="clear"></div>
    <div class="center">
        <div class="qrgmxx">
            <h1>确认购买信息</h1>
            <div class="kuang">
                <ul>
                    <li class="cpbt"><span>商品标题</span></li>
                    <li class="jg">价格</li>

                    <li class="dj">单价</li>

                </ul>
                <ul>
                    <li class="cpbt">
                        <img src="http://pic.ofcard.com/7881/market/images/buy/buy_ji.png" />
                        <em>
                            【当面交易】5000万金=98元 地下城与勇士 浙江区浙江7区
                        </em><br />
                        物品类型： 游戏币<br />

                        游戏区服： 地下城与勇士 /浙江区
                        /浙江7区
                    </li>
                    <li class="jg">
                        <strong style=" color:#F90">98.00</strong>元
                    </li>

                    <li class="dj">
                        1元=51.02万金<br />
                        0.0196元/万金
                    </li>

                </ul>
            </div>
        </div>
    </div>
    <form id="goodsForm" action="/procurement/purchaseGoods.action?from=" method="post">
        <div class="center">
            <div class="txcpdd">
                <h1>填写商品订单</h1>
                <style>
                    .tips-of3b {
                        background: #ffdfbe;
                        padding: 10px 20px;
                        color: red;
                        font-size: 14px;
                        margin: 5px 20px 0 20px;
                    }

                        .tips-of3b p {
                            text-indent: 1em;
                            margin: 5px 0 0;
                        }
                </style>

                <!--金币购买-->
                --------------金币购买--------------
                <goldorder></goldorder>
                --------------账号购买--------------
                <!--账号购买-->
                <accountorder></accountorder>
                --------------点券购买--------------
                <!--点券购买-->
                <cashorder></cashorder>
            </div>
        </div>
        <div class="clear"></div>
    </form>
    <div class="clear"></div>
    <div class="center">
        <div class="qdtjdd">
            <h1>确认提交订单</h1>
            <ul>
                <li>
                    7881官方任何工作人员，都<b>不会</b>通
                    QQ、电话或游戏内等方式，您索要您的登陆密码、手机号码或手机验证码！如有人冒充7881工作人员向您索要，请千万不要提供！并第一时间联系7881官方客服，电话：400-187-7881（此号码无外拨功能）。
                </li>
                <li>
                    需支付总价<input type="text" id="text_goodsprice"
                                style="color:#F90; font-size:16px; font-weiht:bold; text-align:center; border:0px;width:65px;"
                                readonly="readonly" />元
                </li>
                <li>
                    <input type="button" id="hlkOK" class="buy_gm_qdww" />
                    <span style="padding-left: 20px;" class="jf_detail hide">购买可获得<em id="nowJf" style="padding: 0 2px; color: #ff6700;">0</em>积分</span><s class="hide" style="color: silver;margin-left: 5px;">(<em id="oldJf">0</em>积分)</s>
                </li>
                <li>
                    <input type="checkbox" id="agreement" checked="checked" style=" height:12px;" />&nbsp;我已阅读并同意<a href="/gmxy.html" target="_blank" class="ls">《7881网游交易购买协议》</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="clear"></div>
    <div class="center">
        <div class="ddwt">
            <h1>订单遇到问题：</h1>
            <ul>
                <li>
                    1.订单号无效，怎么回事啊？<br />
                    回答：请确保您的订单成功支付了，否则无法成功取货哦。
                </li>
                <li><a href="/helpcenter.html" target="_blank" class="ls">更多帮助</a></li>
            </ul>
        </div>
    </div>
    <!--  -->
    <!--底部开始-->
    <div class="clear"></div>
    <div class="center" style="border-bottom:1px solid #CAC9C9; width:100%; height:1px; margin-top:10px;"></div>
    <div class="clear"></div>
    <div class="foot">
        <div class="center foot_wenzi">
            <a href="http://www.7881.com/aboutus.html" target="_blank" class="hs" rel="nofollow">&nbsp;关于我们&nbsp;</a> |
            <a href="http://www.7881.com/contactus.html" target="_blank" class="hs" rel="nofollow">&nbsp;联系我们&nbsp;</a> |
            <a href="http://www.7881.com/copyright.html" target="_blank" class="hs" rel="nofollow">&nbsp;免责声明&nbsp;</a> |
            <a href="http://www.7881.com/hr.html" target="_blank" class="hs" rel="nofollow">&nbsp;诚聘英才&nbsp;</a> |
            <a href="http://www.7881.com/ParentalControls.jsp" target="_blank" class="hs" rel="nofollow">&nbsp;家长监护&nbsp;</a> |
            <a href="http://www.7881.com/cooperation.html" target="_blank" class="hs" rel="nofollow">&nbsp;商务合作&nbsp;</a> |
            <a href="http://www.7881.com/sitemap.html" target="_blank" class="hs">&nbsp;网站地图&nbsp;</a> |
            <a href="http://www.7881.com/articlelist9-0-0.html" target="_blank" class="hs">&nbsp;媒体声音&nbsp;</a> <br />
            Copyright Reserved 2008-2016 &copy; 7881游戏交易   网络文化经营许可证：
            <a href="http://www.7881.com/contectus/lianxiwomen.jsp" target="_blank" class="hs" rel="nofollow">苏网文[2015]2034-038号</a>
            网站备案-<a href="http://www.miibeian.gov.cn/publish/query/indexFirst.action" target="_blank" class="hs">苏B1-20110004-4</a>
        </div>
        <div class="mb10 center cent">
            <a target="_blank" rel="nofollow" href="http://www.miibeian.gov.cn"><img src="http://pic.ofcard.com/7881/market/images/foot_1.png" /> 网站备案信息</a>
            <a target="_blank" rel="nofollow" href="http://www.cyberpolice.cn/wfjb/"><img src="http://pic.ofcard.com/7881/market/images/foot_2.png" /> 网络警察</a>
            <a target="_blank" rel="nofollow" href="https://www.alipay.com"><img src="http://pic.ofcard.com/7881/market/images/foot_3.png" /> 支付宝特约商户</a>
            <a target="_blank" rel="nofollow" href="http://www.anquan.org/authenticate/cert/?site=www.7881.com&sn=2013071816040123804"><img src="http://pic.ofcard.com/7881/market/images/foot_6.png" /> 安全联盟</a>
            <a target="_blank" rel="nofollow" href="http://sq.ccm.gov.cn/ccnt/sczr/service/business/emark/toDetail/6C975C7695A34AD89E8416C44BEE105B"><img src="http://pic.7881.com/7881/market/images/foot_8.png" /> 中国文化部</a>
        </div>
        <div class="tleft"></div>
    </div>
    <!--底部结束-->
    <script type="text/javascript">
function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/1.1);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }
    </script>
    <DIV style="DISPLAY: none" id="goTopBtn"><IMG border=0 src="http://pic.ofcard.com/7881/market/images/index_top.jpg" alt="返回头部"></DIV>
    <SCRIPT type=text/javascript>goTopEx();</SCRIPT>
    <div style="display: none;">
        <script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F6fb35abaf76325a4316e33e23c984e73' type='text/javascript'%3E%3C/script%3E"));
        </script>
        <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-44365965-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

        </script>
    </div>
</body>

<script type="text/javascript">

    function calcMallIntegral(goodsprice){
        var gameId = "G10";
        var gtId = "100001";
        var groupId = "G10P008";
        var serverId = "G10P008006";
        $.ajax({
            url:"/procurement/getMallIntegral.action",
            data:{
                "gameId":gameId,
                "gtId":gtId,
                "groupId":groupId,
                "serverId":serverId,
                "price":goodsprice
            },
            type:"POST",
            dataType:"JSON",
            success:function(result){
                if(!result){
                    return;
                }
                var mallJf = result.creditPoint;//商城积分比率
                var oldMallJf = result.preCreditPoint;//商城历史积分比率
                if(mallJf && mallJf > 0){
                    if(oldMallJf && oldMallJf > 0){
                        var _oldJf = parseInt(price/oldMallJf);
                        if(_oldJf > 0){
                            $("#oldJf").parent().removeClass("hide");
                            $("#oldJf").html(oldMallJf);
                        }else{
                            $("#oldJf").parent().addClass("hide");
                            $("#oldJf").html("0");
                        }
                    }
                    $("#nowJf").html(mallJf);
                    $("#nowJf").parent().removeClass("hide");
                }
            }
        })
    }

    // 基础工具类
    BaseJs = {};
    // 判断数组
    BaseJs.isArray = function (v) {
        return v.constructor == Array;
    };
    // json工具
    BaseJs.Json = new (function () {

        var useHasOwn = !!{}.hasOwnProperty,

                pad = function (n) {
                    return n < 10 ? "0" + n : n;
                },
        // 编码
                doDecode = function (json) {
                    return eval("(" + json + ')');
                },
        // 解码
                doEncode = function (o) {

                    if (typeof o == "undefined" || o === null) {
                        return "null";
                    } else if (BaseJs.isArray(o)) {
                        return encodeArray(o);
                    } else if (Object.prototype.toString.apply(o) === '[object Date]') {
                        return BaseJs.Json.encodeDate(o);
                    } else if (typeof o == "string") {
                        return encodeString(o);
                    } else if (typeof o == "number") {
                        return isFinite(o) ? String(o) : "null";
                    } else if (typeof o == "boolean") {
                        return String(o);
                    } else {
                        var a = ["{"], b, i, v;
                        for (i in o) {
                            if (!useHasOwn || o.hasOwnProperty(i)) {
                                v = o[i];
                                switch (typeof v) {
                                    case "undefined" :
                                    case "function" :
                                    case "unknown" :
                                        break;
                                    default :
                                        if (b) {
                                            a.push(',');
                                        }
                                        a.push(doEncode(i), ":", v === null
                                                ? "null"
                                                : doEncode(v));
                                        b = true;
                                }
                            }
                        }
                        a.push("}");
                        return a.join("");
                    }
                }, m = {
                    "\b": '\\b',
                    "\t": '\\t',
                    "\n": '\\n',
                    "\f": '\\f',
                    "\r": '\\r',
                    '"': '\\"',
                    "\\": '\\\\'
                }, encodeString = function (s) {
                    if (/["\\\x00-\x1f]/.test(s)) {
                        return '"' + s.replace(/([\x00-\x1f\\"])/g, function (a, b) {
                                    var c = m[b];
                                    if (c) {
                                        return c;
                                    }
                                    c = b.charCodeAt();
                                    return "\\u00" + Math.floor(c / 16).toString(16)
                                            + (c % 16).toString(16);
                                }) + '"';
                    }
                    return '"' + s + '"';
                }, encodeArray = function (o) {
                    var a = ["["], b, i, l = o.length, v;
                    for (i = 0; i < l; i += 1) {
                        v = o[i];
                        switch (typeof v) {
                            case "undefined" :
                            case "function" :
                            case "unknown" :
                                break;
                            default :
                                if (b) {
                                    a.push(',');
                                }
                                a.push(v === null ? "null" : BaseJs.Json.encode(v));
                                b = true;
                        }
                    }
                    a.push("]");
                    return a.join("");
                };

        this.encodeDate = function (o) {
            return '"' + o.getFullYear() + "-" + pad(o.getMonth() + 1) + "-"
                    + pad(o.getDate()) + "T" + pad(o.getHours()) + ":"
                    + pad(o.getMinutes()) + ":" + pad(o.getSeconds()) + '"';
        };
        this.encode = function () {
            return function (o) {
                return doEncode(o);
            };
        }();
        this.decode = function () {
            var dc;
            return function (json) {
                return doDecode(json);
            };
        }();

    })();

    if ('true' == 'false') {
        alert('');
        if ('' == 'yes') {
            window.location.href = '/goods-201612376080214.html';
        }
    }
    if ('119913311' == '119916776') {
        // 购买自己发布的商品，跳转到商品详情页面
        window.location.href = '/goods-201612376080214.html';
    }
    if ('false' == 'true') {
        window.location.href = '/buy-G10-0-100001-G10P008-G10P008006-0-0-0-0-0-0.html';
    }
    if ($.trim($('#stock').val()) != '' && !isNaN($('#stock').val())) {
        var goodsprice = eval($('#price').val() + '*' + $('#stock').val()).toFixed(3);
        goodsprice=goodsprice+'';
        if(goodsprice.indexOf(".")!=-1){
            goodsprice=goodsprice.substring(0, goodsprice.indexOf(".")+3);
        }
        if(parseFloat(goodsprice)<0.01){
            goodsprice=0.01;
        }
        $('#text_goodsprice').val(goodsprice);
        calcMallIntegral(goodsprice);
    }
    $(document).ready(function () {
        if ($('#stock').attr('nodetype') != 'select') {
            restrict_digit_input($('#stock'));
        } else {
            $('#stock').change(function () {
                var goodsprice = eval($('#price').val() + '*' + $('#stock').val()).toFixed(3);
                goodsprice=goodsprice+'';
                if(goodsprice.indexOf(".")!=-1){
                    goodsprice=goodsprice.substring(0, goodsprice.indexOf(".")+3);
                }
                if(parseFloat(goodsprice)<0.01){
                    goodsprice=0.01;
                }
                $('#text_goodsprice').val(goodsprice);
                calcMallIntegral(goodsprice);
            });
        }
        restrict_digit_input($('input[rolegrade="rolegrade"]'));

        if ('' != '') {
            $('input:radio[prid=""]').attr('checked', true);
            $('input:radio[prid=""]').trigger('change');
        } else {
            $('#dxk').parent().find(':radio:first').attr('checked', true);
        }

        $(".txcpdd").on('blur',':text,textarea',function () {
            if ($.trim($(this).val()) != '' && $(this).attr('regexp') && $(this).attr('regexp_desc')) {
                var pattern = new RegExp($(this).attr('regexp'));
                if (!pattern.test($(this).val())) {
                    $(this).parent().find('p').remove();
                    $(this).parent().append('<p class="cw"> ' + $(this).attr('regexp_desc') + '</p>');
                    return false;
                }
            }
            if($(this).attr("id")=="tgm"){
                check();
                if(isok=="1"){
                    $(this).parent().find('p').remove();
                    $(this).parent().append('<p class="cw">推广码无效，如无可不填写</p>');
                    return false;
                }else{
                    $(this).parent().find('p').remove();
                }
            }
            if($(this).attr("id")=="jyam"){
                var jval=$("#jyam").val();
                if(jval==""||jval==null||jval.length!=4){
                    $(this).parent().find('p').remove();
                    $(this).parent().append('<p class="cw">请您随机填写4位数的数字交易暗号，并在发货员向您索要时提供</p>');
                    return false;
                }else{
                    $(this).parent().find('p').remove();
                }
            }
            if ($(this).attr('required')) {
                return false;
            }
            if ($(this).attr('readonly')) {
                return false;
            }
            if ($(this).is(':hidden')) {
                return false;
            }
            if ($(this).attr('id') == 'stock' && $.trim($('#stock').val()) != '' && !isNaN($('#stock').val())) {
                var goodsprice = eval($('#price').val() + '*' + $('#stock').val()).toFixed(3);
                goodsprice=goodsprice+'';
                if(goodsprice.indexOf(".")!=-1){
                    goodsprice=goodsprice.substring(0, goodsprice.indexOf(".")+3);
                }
                if(parseFloat(goodsprice)<0.01){
                    goodsprice=0.01;
                }
                $('#text_goodsprice').val(goodsprice);
                calcMallIntegral(goodsprice);

                if('100001' == '100149' && $('#stock').val() > 1){
                	$("#qq_account").parent().find('p').remove();
                	$("#qq_account").after('<p class="cw"> 购买多个,QQ号请以逗号连接</p>');
                }
            }
            var djflag=0;
            var gameid="G10";
            var gtid="100001";
            if(gameid=="A2492"){
	             if(gtid=='100001' || gtid=='100002'){
	               djflag=1;
	             }
            }
            $(this).parent().find('p').remove();


            if(gameid=="G10" && gtid != "100148"){
                var rolename = $("#txtRole").val();
                if(rolename!= "" && (rolename.indexOf(" ") == 0 || rolename.indexOf(" ") == rolename.length -1)){
                    if(!confirm("您的角色名前后带空格，提交时会自动去掉")){
                        return false;
                    }else{
                        rolename = $.trim(rolename);
                        $('#txtRole').val(rolename);
                    }
                }
            }

            if ($.trim($(this).val()) == '') {
                $(this).after('<p class="cw"> 请填写' + $(this).attr('desc') + '</p>');
            } else if ($(this).attr('maxval') && parseInt($(this).val(), 10) > parseInt($(this).attr('maxval'), 10)) {
                $(this).after('<p class="cw"> 超过最大' + $(this).attr('desc') + '</p>');
            } else if ($(this).attr('compare') && $(this).attr('compare') == 'true' && $(this).val() != $('#' + $(this).attr('compareid')).val()) {
                $(this).after('<p class="cw"> ' + $(this).attr('desc') + '与' + $('#' + $(this).attr('compareid')).attr('desc') + '不一致</p>');
            } else if($(this).attr('desc')=="角色等级"&&$.trim($(this).val())){
                var dengji=$.trim($(this).val());
                if(isNaN(dengji)){
                    $(this).after('<p class="cw">请填写角色等级</p>');
                }else{
                    if(djflag==1&&dengji<40){
                        $(this).after('<p class="cw">达到40级才能交易哦</p>');
                    }else{
                        $(this).after('<p class="zq">&nbsp;</p>');
                    }
                }
            }else if($(this).attr('desc')=="角色名"){
                checkRoleNameLength($(this).val());
            } else {
                $(this).after('<p class="zq">&nbsp;</p>');
            }
            return false;
        });
        $('#hlkOK').click(function () {
            var gid="201612376080214";
            buyGoodsFlag(gid);
            if(buygoodsflag==1){
              return false;
           }
            $('p.cw,p.zq,p.txcpdd_default').remove();
            var flag = true;
            var roleNameFlag = true;
            $.each($(".txcpdd").find(':text,textarea'), function (i, item) {
                if ($.trim($(item).val()) != '' && $(item).attr('regexp') && $(item).attr('regexp_desc')) {
                    var pattern = new RegExp($(item).attr('regexp'));
                    if (!pattern.test($(item).val())) {
                        $(item).parent().append('<p class="cw"> ' + $(this).attr('regexp_desc') + '</p>');
                        if (flag) {
                            flag = false;
                        }
                        return true;
                    }
                }

                if ($(item).attr('required')) {
                    return true;
                }
                if ($(item).attr('readonly')) {
                    return true;
                }
                if ($(item).is(':hidden')) {
                    return true;
                }
		           var djflag=0;
		           var gameid="G10";
		           var gtid="100001";
		           if(gameid=="A2492"){
		             if(gtid=='100001' || gtid=='100002'){
		               djflag=1;
		             }
		           }
                if ($.trim($(this).val()) == '') {
                    $(this).after('<p class="cw"> 请填写' + $(this).attr('desc') + '</p>');
                    flag = false;
                } else if ($(this).attr('maxval') && parseInt($(this).val(), 10) > parseInt($(this).attr('maxval'), 10)) {
                    $(this).after('<p class="cw"> 超过最大' + $(this).attr('desc') + '</p>');
                    flag = false;
                } else if ($(this).attr('compare') && $(this).attr('compare') == 'true' && $(this).val() != $('#' + $(this).attr('compareid')).val()) {
                    $(this).after('<p class="cw"> ' + $(this).attr('desc') + '与' + $('#' + $(this).attr('compareid')).attr('desc') + '不一致</p>');
                    flag = false;
                } else if($(this).attr('desc')=="角色等级"&&$.trim($(this).val())){
                    var dengji=$.trim($(this).val());
                    var verifyFlag=true;
                    if(isNaN(dengji)){
                        $(this).after('<p class="cw">请填写角色等级</p>');
                        flag= false;
                        verifyFlag=false;
                    }else{
                        if(verifyFlag) {
                            if (djflag == 1 && dengji < 40) {
                                $(this).after('<p class="cw">达到40级才能交易哦</p>');
                                flag = false;
                            } else {
                                $(this).after('<p class="zq">&nbsp;</p>');
                            }
                        }
                    }
                }else if($(this).attr('desc')=="角色名" || $(this).attr('desc')=="确认角色名"){
                    if(roleNameFlag && !checkRoleNameLength($(this).val())){
                        flag = false;
                        roleNameFlag = false;
                    }
                } else {
                    $(this).after('<p class="zq">&nbsp;</p>');
                }
            });
            if (!flag) {
                return false;
            }
            var gameidn="G10";
            var gtid="100001";
            var tradetypen="js";
            var tradeplacen="【当面交易】";
            if(gameidn =="G10" && tradetypen=="js" && tradeplacen=="【附魔交易】"){
                var jyam=$("#jyam").val();
                if(jyam==null||jyam==""||jyam.length!=4){
                    $("#jyam").after('<p class="cw">请您随机填写4位数的数字交易暗号，并在发货员向您索要时提供</p>');
                    return false;
                }
            }else if(gameidn =="G10" && tradeplacen=="【当面交易】"){
                var jyam=$("#jyam").val();
                if(jyam==null||jyam==""||jyam.length!=4){
                    $("#jyam").after('<p class="cw">请填写4位数交易暗码，在商品交易时需要进行校验</p>');
                    return false;
                }
            }

            check();
            if(isok=="1"){
                alert("推广码无效，如无可不填写");
                $("#tgm").after('<p class="cw">推广码无效，如无可不填写</p>');
                return false;
            }
         /*   if($("input[name='goodsPurchaseBean.serverid']").val()==""){
                alert("请选择号具体的区服信息！");
                return false;
            }*/

            if($('#groupNameSel').val()=='-1'){
                $('#serverNameSel').after('<p class="cw">请选择区</p>');
                return false;
            }else{
                $('#groupNameSel').parent().find('.check_no,.no').remove();
            }
            if($('#serverNameSel').val()=='-1'){
                $('#serverNameSel').after('<p class="cw">请选择服</p>');
                return  false;
            }else{
                $('#serverNameSel').parent().find('.check_no,.no').remove();
            }

            if(gameidn=="G10" && (gtid == "100148" || gtid == "100151")){//DNF金团
                var roleCount = 0;
                var roleName = "";
                $(".roleIpt").each(function () {
                    if ($(this).val() != "") {
                        roleName += ";"+$(this).val();
                        roleCount ++;
                    }
                });

                if($('#stock').val() != roleCount){
                    alert("购买数量与角色名称数量不一致");
                    return false;
                }
                $('#buyerRolename').val(roleName.substr(1));
            }


            var p = $('input:radio[name="radRole"]:checked').attr("prid");
            var rolname = "";
            if(typeof(p) == "undefined" || p == 0 || p == -1){
            	rolname = $("#txtRole").val();
            }else if (p > 0){
            	rolname = $('input:radio[name="radRole"]:checked').attr("rname");
            }
//            if(rolname !="" && (rolname.indexOf(" ") == 0 || rolname.indexOf(" ") == rolname.length -1)){
//            	if(!confirm("您的角色名前后带空格，提交时会自动去掉")){
//            		return false;
//            	}
//            }

            if(roleNameFlag && !checkRoleNameLength(rolname)){
                return false;
            }

            if (!$('#agreement').attr('checked')) {
                alert('同意《7881网游交易购买协议》方可购买');
                return false;
            }


            var buyer = '119913311';
            var seller = '119916776';
            if (buyer && buyer == seller) {
                alert('不能购买自己发布的商品');
                return false;
            }


            // 抱歉,1分钟内请勿提交相同的订单请求!
            $.ajax({
                type: 'post',
                url: '/procurement/queryGoodsMemPurchaseState.action',
                data: {goodsid: '201612376080214'},
                dataType: 'json',
                success: function (data) {
                    if (data.success == 'T') {
                        checkPurchase();
                    } else {
                        alert('抱歉,1分钟内请勿提交相同的订单请求!');
                    }
                }
            });
            return false;
        });
    });

    //全区区服的商品，增加区服选择信息
    var _gameId='G10';
    var _carrierid='';
    var _carrierName='';
    var _userChooseGroupId='';
    var _userChooseServerId='';
    var servers={};
    $(function(){
        if('浙江区'=="全区"&&'浙江7区'=="全服"){
            $("input[name='goodsPurchaseBean.groupid']").val("");
            $("input[name='goodsPurchaseBean.serverid']").val("");
            getGameServerInfo();
            $("#groupNameSel").change(function(){
                var selectGroupId= $("#groupNameSel").find("option:selected").val();
                var selectGroupName= $("#groupNameSel").find("option:selected").text();
                $("input[name='goodsPurchaseBean.groupid']").val(selectGroupId);
                $("input[name='goodsPurchaseBean.groupname']").val(selectGroupName);
                var serverObjs=servers["group_"+selectGroupId];
                $("#serverNameSel").find("option").remove();
                $("#serverNameSel").append("<option value='-1'>请选择服</option>");
                if(serverObjs.length>0){
                    for(var s in serverObjs){
                        var serverobj=serverObjs[s];
                        var serverName=serverobj.servername;
                        var serverId=serverobj.serverid;
                        $("#serverNameSel").append("<option value="+serverId+">"+serverName+"</option>");
                    }
                }
            });
            $("#serverNameSel").change(function(){
                var selectServerId= $("#serverNameSel").find("option:selected").val();
                var selectServerName= $("#serverNameSel").find("option:selected").text();
                $("input[name='goodsPurchaseBean.serverid']").val(selectServerId);
                $("input[name='goodsPurchaseBean.servername']").val(selectServerName);
            });

            if(_userChooseGroupId){
                $("#groupNameSel option[value='"+_userChooseGroupId+"']").attr("selected", true);
                $("#groupNameSel").change();
            }

            if(_userChooseServerId){
                $("#serverNameSel option[value='"+_userChooseServerId+"']").attr("selected", true);
                $("#serverNameSel").change();
            }
        }
    });

    function getGameServerInfo(){
        $.ajax({
            url:"../getGameQuFuInfo.action",
            async:false,
            datatype:"json",
            data:{"gameid":_gameId},
            success:function(data){
                iniServerIndfo(data);
            }
        });
    }

    function iniServerIndfo(data){
        var carriers=data.carriers;
        for(var i in carriers){
            var carrier=carriers[i];
            var carrierid=carrier.carrierid;
            var carrierName=carrier.carriername;
            if(carrierName==_carrierName){
                var groups=carrier.groups;
                if(groups.length>0){
                    for(var g in groups){
                        var groupObj=groups[g];
                        var groupId=groupObj.groupid;
                        var groupName=groupObj.groupname;
                        $("#groupNameSel").append("<option value="+groupId+">"+groupName+"</option>");
                        servers["group_"+groupId]=groupObj.servers;
                    }
                }
            }
        }
    }

    function selectPurchaseQQStock(){
        var stockValue=$("#qqCoinSel").val();
        if(stockValue){
            $("#stock").val(stockValue);
        }
        var goodsprice = eval($('#price').val() + '*' + $('#stock').val()).toFixed(3);
        goodsprice=goodsprice+'';
        if(goodsprice.indexOf(".")!=-1){
            goodsprice=goodsprice.substring(0, goodsprice.indexOf(".")+3);
        }
        if(parseFloat(goodsprice)<0.01){
            goodsprice=0.01;
        }
        $('#goodsprice').val(goodsprice);
        $('#text_goodsprice').val(goodsprice);
    }
    $(function(){

        restrict_digit_input($('#djtxt'));
        selectPurchaseQQStock();
    });

var buygoodsflag=1;
var activityid=4;
 function buyGoodsFlag(goodsid){
	   $.ajax({
            type:'post',
            data:{activityid:activityid,goodsid:goodsid},
            url:'/activity/buyGoodsFlag.action',
            dataType:'json',
            async:false,
            success:function(json) {
            if(json!=2){
               $("#stock").val(1);
               $("#stock").attr("disabled",true);
               $(".txcpdd_default").html("(可购1件)");
            }
               if(json==1){
                   alert("您购买的商品不在活动时间内");
                   buygoodsflag=1;
                   return false;
               }else if(json==3||json==4){
                   alert("已抢光");
                   buygoodsflag=1;
                   return false;
               }else{
                   buygoodsflag=0;
               }
            }
        });
}

    $(document).ready(function(){
        var gid="201612376080214";
        buyGoodsFlag(gid);
        if(buygoodsflag==1){
            return false;
        }
        var roleCount='0';
        if(roleCount=='0'){
            $("#fuzhi_0").show();
        }

        $(".buyNum").find("select").val($("#buyNum").val()).change();
        $(".buyNum").find("input").val($("#buyNum").val()).click().blur().keyup();
    });

    var isok="0";
    function getCodeFlag(){
        var code=$("#tgm").val();
        $.ajax({
            type: 'post',
            url:"/procurement/getCodeFlag.action",
            data:{code:code},
            async:false,
            cache:false,
            success:function(json){
                if(json=="yes"){
                    isok= "0";
                }else{
                    isok= "1";
                }

            }
        });
    }
    function check(){
        var code=$("#tgm").val();
        if(code!=null&&code!=""){
            getCodeFlag();
        }else{
            isok="0";
        }
    }
function checkRoleNameLength(rolname){
    if('G10' == 'G10' && ('100001' == '100001'
            || '100001' == '100072' || '100001' == '100002'
            || '100001' == '100111'  || '100001' == '100113') ){
        var str_length = getByteLen(rolname);
        if(str_length > 12){
            alert("角色名称长度不可超过12个字符,一个汉字等于2个字符");
            return false;
        }
    }
    return true;
}
</script>
<script type="text/javascript">
    var picsrc="";
    var $list = $('#thelist'),
    $btn = $('#ctlBtn'),
    state = 'pending',
// 优化retina, 在retina下这个值是2
    ratio = window.devicePixelRatio || 1,

// 缩略图大小
    thumbnailWidth = 110 * ratio,
    thumbnailHeight = 110 * ratio,

// Web Uploader实例
    uploader;
    // 初始化Web Uploader
    uploader = WebUploader.create({
        // 自动上传。
        auto: true,
        // swf文件路径
        swf: 'http://pic.7881.com/7881-2016/common/uploader/Uploader.swf',
        // 文件接收服务端。
        server: 'http://upload.7881.com/file/fileUploadFlash.action',
        // 选择文件的按钮。可选。
        // 内部根据当前运行是创建，可能是input元素，也可能是flash.
        pick: '#picker',
        fileSingleSizeLimit:2097152,
        duplicate: true,
        formData:{"userid":'119916776'},
        fileVal:'fileImage',
        // 只允许选择文件，可选。
        accept: {
            title: 'Images',
            extensions: 'jpg,jpeg,png',
            mimeTypes: 'image/jpg,image/jpeg,image/png'
        }
    });
    uploader.on('error', function(handler) {
        if(handler=="Q_TYPE_DENIED"){
            alert("请上传正确图片格式");
        }
        if(handler=="F_EXCEED_SIZE") {
            alert("请上传图片大小控制在512K");
        }
    });
    // 当有文件添加进来的时候
    uploader.on( 'fileQueued', function( file ) {
        $(".btns").hide();
        var fileName = file.name;
        var picType = $(".pic-type-box .on").find("b").html();
        if(typeof(picType) != "undefined"){
            fileName = picType;
        }
        var $li = $(
                        '<div id="' + file.id + '" class="file-item thumbnail">' +
                        '<a href="'+picsrc+'" class="example-image-link" data-lightbox="example-set" data-title="7881上传截图"><img></a>' +
                        '<div class="info">' + fileName + '</div>' +
                        '<div class="del-img" onclick="delImg(this)"></div>'+
                        '</div>'
                ),
                $img = $li.find('img');
        $href = $li.find('a');
        $list.append( $li );
        // 创建缩略图
        uploader.makeThumb( file, function( error, src ) {
            if ( error ) {
                $img.replaceWith('<span>不能预览</span>');
                return;
            }

            $img.attr( 'src', src );
        }, thumbnailWidth, thumbnailHeight );

    });

    function delImg(thisSchema){
        $(".btns").show();
        $(thisSchema).parents(".file-item").remove();
    }

    // 文件上传过程中创建进度条实时显示。
    uploader.on( 'uploadProgress', function( file, percentage ) {
        var $li = $( '#'+file.id ),
                $percent = $li.find('.progress span');

        // 避免重复创建
        if ( !$percent.length ) {
            $percent = $('<p class="progress"><span style="background-color: green;">&nbsp;</span></p>')
                    .appendTo( $li )
                    .find('span');
        }
        $percent.css( 'width', percentage * 100 + '%' );
    });

    // 文件上传成功，给item添加成功class, 用样式标记上传成功。
    uploader.on( 'uploadSuccess', function( file,response ) {
        $href.attr( 'href', response.url );
        if(response.status==100){
            return false;
        }else{
            $( '#'+file.id ).addClass('upload-state-done');
            $( '#'+file.id ).attr("url",response.url);
        }
    });
    // 文件上传失败，显示上传出错。
    uploader.on( 'uploadError', function( file ) {
        var $li = $( '#'+file.id ),
        $error = $li.find('div.error');

        // 避免重复创建
        if ( !$error.length ) {
            $error = $('<div class="error"></div>').appendTo( $li );
        };
        $error.text('上传失败');
    });

    // 完成上传完了，成功或者失败，先删除进度条。
    uploader.on( 'uploadComplete', function( file ) {
        $( '#'+file.id ).find('.progress').remove();

    });

    uploader.on( 'all', function( type ) {
        if ( type === 'startUpload' ) {
            state = 'uploading';
        } else if ( type === 'stopUpload' ) {
            state = 'paused';
        } else if ( type === 'uploadFinished' ) {
            state = 'done';
        }

        if ( state === 'uploading' ) {
            $btn.text('暂停上传');
        } else {
            $btn.text('开始上传');
        }
    });

    $btn.on( 'click', function() {
        if ( state === 'uploading' ) {
            uploader.stop();
        } else {
            uploader.upload();
        }
    });
</script>
</html>